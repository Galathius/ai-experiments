<div class="min-h-screen bg-gray-50">
  <%= render "layouts/minimal_header", page_title: "Activity Logs", container_class: "max-w-6xl" %>

  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Breadcrumb Navigation -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2">
        <li>
          <%= link_to root_path, class: "text-gray-500 hover:text-gray-700" do %>
            <%= inline_svg "icons/home.svg", class: "w-4 h-4" %>
          <% end %>
        </li>
        <%= inline_svg "icons/chevron-right.svg", class: "w-4 h-4 text-gray-400" %>
        <li>
          <span class="text-gray-900 font-medium">Activity Logs</span>
        </li>
      </ol>
    </nav>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <%= inline_svg "icons/clipboard.svg", class: "w-8 h-8 text-blue-600" %>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-medium text-gray-900">Total Actions</h3>
            <p class="text-2xl font-bold text-blue-600"><%= @stats[:total] %></p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <%= inline_svg "icons/check.svg", class: "w-8 h-8 text-green-600" %>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-medium text-gray-900">Successful</h3>
            <p class="text-2xl font-bold text-green-600"><%= @stats[:successful] %></p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <%= inline_svg "icons/warning.svg", class: "w-8 h-8 text-red-600" %>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-medium text-gray-900">Failed</h3>
            <p class="text-2xl font-bold text-red-600"><%= @stats[:failed] %></p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <%= inline_svg "icons/clock.svg", class: "w-8 h-8 text-purple-600" %>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-medium text-gray-900">Today</h3>
            <p class="text-2xl font-bold text-purple-600"><%= @stats[:today] %></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity Log -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900">Recent Activity</h2>
          <span class="text-sm text-gray-500">Last 50 actions</span>
        </div>
      </div>

      <% if @action_logs.any? %>
        <div class="divide-y divide-gray-200">
          <% @action_logs.each do |log| %>
            <div class="p-6 hover:bg-gray-50 transition-colors">
              <div class="flex items-start justify-between">
                <div class="flex-1 min-w-0">
                  <div class="flex items-center space-x-3 mb-2">
                    <!-- Status Icon -->
                    <% if log.successful? %>
                      <div class="flex-shrink-0 w-2 h-2 bg-green-400 rounded-full"></div>
                    <% else %>
                      <div class="flex-shrink-0 w-2 h-2 bg-red-400 rounded-full"></div>
                    <% end %>
                    
                    <!-- Tool Summary -->
                    <h3 class="text-sm font-medium text-gray-900">
                      <%= log.summary %>
                    </h3>
                    
                    <!-- Status Badge -->
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= log.successful? ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                      <%= log.successful? ? 'Success' : 'Failed' %>
                    </span>
                  </div>
                  
                  <!-- Tool Details -->
                  <div class="space-y-2">
                    <div class="text-sm text-gray-600">
                      <span class="font-medium">Tool:</span> <%= log.tool_name %>
                    </div>
                    
                    <!-- Parameters -->
                    <% if log.parameters.present? %>
                      <div class="text-sm text-gray-600">
                        <span class="font-medium">Parameters:</span>
                        <div class="mt-1 p-2 bg-gray-100 rounded text-xs font-mono overflow-x-auto">
                          <%= JSON.pretty_generate(log.parameters) %>
                        </div>
                      </div>
                    <% end %>
                    
                    <!-- Result -->
                    <% if log.result.present? %>
                      <div class="text-sm text-gray-600">
                        <span class="font-medium">Result:</span>
                        <div class="mt-1 p-2 <%= log.successful? ? 'bg-green-50' : 'bg-red-50' %> rounded text-xs font-mono overflow-x-auto">
                          <%= JSON.pretty_generate(log.result) %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                </div>
                
                <div class="ml-4 flex-shrink-0 text-right">
                  <p class="text-sm text-gray-500">
                    <%= time_ago_in_words(log.created_at) %> ago
                  </p>
                  <p class="text-xs text-gray-400 mt-1">
                    <%= log.created_at.strftime('%b %d, %Y at %I:%M %p') %>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-12">
          <%= inline_svg "icons/clipboard.svg", class: "w-12 h-12 mx-auto text-gray-400" %>
          <h3 class="mt-4 text-lg font-medium text-gray-900">No activity yet</h3>
          <p class="mt-2 text-sm text-gray-500">
            Tool executions will appear here as you use the AI assistant.
          </p>
          <div class="mt-6">
            <%= link_to root_path, class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
              Go to Chat
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Development Info -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <%= inline_svg "icons/info.svg", class: "w-5 h-5 text-blue-400" %>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">
            Development Testing Page
          </h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>This page shows all tool executions for testing and debugging the AI agent's actions. Use the chat interface to trigger tools like sending emails, creating calendar events, or adding HubSpot notes.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
