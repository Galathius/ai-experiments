<!-- Simple Chat Layout -->
<div style="width: 100%; height: 100%; display: flex; flex-direction: column;">
  <!-- Header with close button only -->
  <div style="flex-shrink: 0; background: white; border-bottom: 1px solid #e5e7eb; padding: 16px;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <h2 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0;">AI Assistant</h2>
      <button id="close-chat-btn" style="color: #9ca3af; cursor: pointer; background: none; border: none; padding: 4px;">
        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Messages Area -->
  <div class="messages-container" style="flex: 1; overflow-y: scroll; padding: 24px; background-color: #f9fafb; min-height: 0;">
    <!-- Initial AI Message -->
    <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;">
      <div style="flex-shrink: 0;">
        <div style="width: 32px; height: 32px; background-color: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
          <svg style="width: 16px; height: 16px; color: white;" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"/>
          </svg>
        </div>
      </div>
      <div style="flex: 1;">
        <div style="background-color: #f3f4f6; border-radius: 8px; padding: 12px;">
          <p style="color: #111827; font-size: 14px; margin: 0;">Hi! I'm your AI assistant. I can help you with emails, calendar events, HubSpot contacts, and task management. What can I help you with today?</p>
        </div>
      </div>
    </div>
    
    <!-- Dynamic messages from database -->
    <% if @current_chat&.messages&.any? %>
      <% @current_chat.messages.ordered.each do |message| %>
        <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px; <%= 'flex-direction: row-reverse;' if message.role == 'user' %>">
          <div style="flex-shrink: 0;">
            <% if message.role == 'user' %>
              <div style="width: 32px; height: 32px; background-color: #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg style="width: 16px; height: 16px; color: #4b5563;" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              </div>
            <% else %>
              <div style="width: 32px; height: 32px; background-color: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg style="width: 16px; height: 16px; color: white;" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"/>
                </svg>
              </div>
            <% end %>
          </div>
          <div style="flex: 1;">
            <div style="<%= message.role == 'user' ? 'background-color: #3b82f6; color: white;' : 'background-color: #f3f4f6; color: #111827;' %> border-radius: 8px; padding: 12px;">
              <p style="font-size: 14px; margin: 0;"><%= simple_format(message.content) %></p>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
  
  <!-- Input Area -->
  <div style="flex-shrink: 0; padding: 16px; border-top: 1px solid #e5e7eb; background-color: white;">
    <form id="chat-form">
      <div style="position: relative;">
        <textarea 
          id="message-input" 
          name="content"
          placeholder="Ask anything about your clients, emails, calendar..."
          style="width: 100%; padding: 12px 48px 12px 12px; border: 1px solid #d1d5db; border-radius: 8px; resize: none; font-size: 14px; outline: none;"
          rows="2"
        ></textarea>
        <div style="position: absolute; bottom: 8px; right: 8px;">
          <button 
            type="button" 
            id="send-btn" 
            style="background-color: #3b82f6; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;"
          >
            <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<input type="hidden" id="current-chat-id" value="<%= @current_chat&.id %>">

<!-- JavaScript will be handled from the dashboard page -->