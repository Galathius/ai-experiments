<!-- Chat Modal matching README mockup -->
<div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: white;">
  <!-- Header -->
  <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px 24px 16px; border-bottom: 1px solid #e5e7eb;">
    <h1 style="font-size: 24px; font-weight: 600; color: #111827; margin: 0;">Ask Anything</h1>
    <button id="close-chat-btn" style="color: #9ca3af; cursor: pointer; background: none; border: none; padding: 4px;">
      <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Tab Navigation -->
  <div style="display: flex; align-items: center; justify-content: space-between; padding: 0 24px; border-bottom: 1px solid #e5e7eb;">
    <div style="display: flex;">
      <button 
        id="chat-tab" 
        class="tab-button active-tab"
        style="padding: 16px 0; margin-right: 32px; border: none; background: none; font-size: 16px; font-weight: 500; cursor: pointer; border-bottom: 2px solid #111827; color: #111827;"
      >
        Chat
      </button>
      <button 
        id="history-tab" 
        class="tab-button"
        style="padding: 16px 0; border: none; background: none; font-size: 16px; font-weight: 400; cursor: pointer; border-bottom: 2px solid transparent; color: #6b7280;"
      >
        History
      </button>
    </div>
    <button 
      id="new-thread-btn"
      style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: none; border: none; font-size: 16px; font-weight: 400; color: #6b7280; cursor: pointer;"
    >
      <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
      New thread
    </button>
  </div>

  <!-- Tab Content Container -->
  <div style="flex: 1; position: relative; min-height: 0;">
    
    <!-- Chat Tab Content -->
    <div id="chat-content" class="tab-content" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column;">
      <!-- Context Bar -->
      <div style="padding: 16px 24px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; text-align: center; flex-shrink: 0;">
        <div style="font-size: 14px; color: #6b7280; margin-bottom: 4px;">Context set to all meetings</div>
        <div style="font-size: 12px; color: #9ca3af;"><%= Time.current.strftime("%l:%M%P - %B %d, %Y") %></div>
      </div>
      
      <!-- Messages Area -->
      <div class="messages-container" style="flex: 1; overflow-y: scroll; padding: 24px; min-height: 0;">
        <!-- Initial AI Message -->
        <div style="margin-bottom: 24px;">
          <div style="background-color: #f3f4f6; border-radius: 16px; padding: 16px; max-width: 80%;">
            <p style="color: #111827; font-size: 16px; margin: 0; line-height: 1.5;">I can answer questions about any Jump meeting. What do you want to know?</p>
          </div>
        </div>
        
        <!-- Dynamic messages from database -->
        <% if @current_chat&.messages&.any? %>
          <% @current_chat.messages.ordered.each do |message| %>
            <div style="margin-bottom: 24px; <%= 'display: flex; justify-content: flex-end;' if message.role == 'user' %>">
              <div style="<%= message.role == 'user' ? 'background-color: #e5e7eb; max-width: 80%;' : 'background-color: #f3f4f6; max-width: 80%;' %> border-radius: 16px; padding: 16px;">
                <p style="color: #111827; font-size: 16px; margin: 0; line-height: 1.5;"><%= simple_format(message.content) %></p>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
      
      <!-- Input Area -->
      <div style="flex-shrink: 0; padding: 24px; border-top: 1px solid #e5e7eb; background: white;">
        <form id="chat-form">
          <div style="position: relative; border: 1px solid #d1d5db; border-radius: 12px; padding: 16px;">
            <textarea 
              id="message-input" 
              name="content"
              placeholder="Ask anything about your meetings..."
              style="width: 100%; border: none; outline: none; resize: none; font-size: 16px; line-height: 1.5; background: transparent;"
              rows="1"
            ></textarea>
            
            <!-- Input Controls -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <!-- Plus button -->
                <button type="button" style="background: none; border: none; cursor: pointer; padding: 4px;">
                  <svg style="width: 20px; height: 20px; color: #6b7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                  </svg>
                </button>
                
                <!-- Dropdown -->
                <select style="background: none; border: none; font-size: 14px; color: #6b7280; outline: none; cursor: pointer;">
                  <option>All meetings</option>
                  <option>Recent meetings</option>
                  <option>This week</option>
                </select>
                
                <!-- Attachment button -->
                <button type="button" style="background: none; border: none; cursor: pointer; padding: 4px;">
                  <svg style="width: 20px; height: 20px; color: #6b7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                  </svg>
                </button>
              </div>
              
              <div style="display: flex; align-items: center; gap: 12px;">
                <!-- Microphone button -->
                <button type="button" style="background: none; border: none; cursor: pointer; padding: 4px;">
                  <svg style="width: 20px; height: 20px; color: #6b7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                  </svg>
                </button>
                
                <!-- Send button -->
                <button 
                  type="button" 
                  id="send-btn" 
                  style="background-color: #3b82f6; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                >
                  <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- History Tab Content -->
    <div id="history-content" class="tab-content" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: none; flex-direction: column; background: white;">
      <div style="flex: 1; overflow-y: auto; padding: 24px;">
        <h3 style="margin: 0 0 20px 0; font-size: 18px; color: #111827;">Chat History</h3>
        
        
        <!-- Chat History List -->
        <div id="chat-history-list">
          <% if @chats.any? %>
            <% @chats.each do |chat| %>
              <div 
                class="chat-history-item"
                data-chat-id="<%= chat.id %>"
                style="padding: 16px; background-color: white; border-radius: 12px; cursor: pointer; border: 1px solid #e5e7eb; margin-bottom: 12px; <%= 'border-color: #3b82f6; background-color: #eff6ff;' if chat == @current_chat %>"
              >
                <div style="font-weight: 500; font-size: 16px; color: #111827; margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  <%= chat.title %>
                </div>
                <div style="font-size: 14px; color: #6b7280;">
                  <%= time_ago_in_words(chat.updated_at) %> ago
                  <% if chat.messages.any? %>
                    â€¢ <%= pluralize(chat.messages.count, 'message') %>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% else %>
            <div style="text-align: center; padding: 48px 24px; color: #6b7280;">
              <svg style="width: 48px; height: 48px; margin: 0 auto 16px; color: #d1d5db;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              <p style="font-size: 16px; margin: 0;">No chat history yet</p>
              <p style="font-size: 14px; margin: 8px 0 0; color: #9ca3af;">Start a conversation to see your chat history here</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
  </div>
</div>

<input type="hidden" id="current-chat-id" value="<%= @current_chat&.id %>">

<!-- JavaScript will be handled from the dashboard page -->